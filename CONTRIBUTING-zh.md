# 贡献指南

[English](CONTRIBUTING.md)

感谢您有兴趣为 AGS CLI 做出贡献！本文档提供了贡献的指南和说明。

## 目录

- [行为准则](#行为准则)
- [如何贡献](#如何贡献)
  - [报告 Bug](#报告-bug)
  - [提出功能需求](#提出功能需求)
  - [提交设计蓝本](#提交设计蓝本)
  - [提交 Pull Request](#提交-pull-request)
- [开发环境设置](#开发环境设置)
- [编码规范](#编码规范)
- [提交信息规范](#提交信息规范)
- [审核流程](#审核流程)

## 行为准则

本项目遵循 [CNCF 行为准则](CODE_OF_CONDUCT.md)。参与本项目即表示您同意遵守该准则。如发现不当行为，请向项目维护者报告。

## 如何贡献

### 报告 Bug

在创建 Bug 报告之前，请先搜索现有 Issue 以避免重复。

提交 Bug 报告时，请包含以下信息：

1. **标题**：清晰描述问题的标题
2. **环境信息**：操作系统、Go 版本、AGS CLI 版本
3. **复现步骤**：详细的问题复现步骤
4. **预期行为**：您期望发生的结果
5. **实际行为**：实际发生的结果
6. **日志/截图**：相关的日志或截图
7. **其他信息**：任何其他相关信息

创建 Issue 时请使用 Bug 报告模板。

### 提出功能需求

我们欢迎功能建议！提出新功能时请：

1. **检查现有 Issue**：先搜索是否有类似的功能请求
2. **创建 Issue**：使用功能请求模板
3. **描述功能**：清晰地解释该功能
4. **使用场景**：描述使用场景和收益
5. **替代方案**：列出您考虑过的替代方案

### 提交设计蓝本

对于重大变更或新功能，我们建议先提交设计蓝本：

1. **编写设计文档**：设计文档应包含：
   - 问题陈述
   - 提议的解决方案
   - 技术设计细节
   - API 变更（如有）
   - 迁移计划（如适用）
   - 测试策略

2. **提交为 Issue**：创建带有 `design-proposal` 标签的 Issue

3. **讨论**：与维护者和社区进行讨论

4. **获得批准**：在开始实现之前等待维护者批准

### 提交 Pull Request

1. **Fork 仓库**：Fork 并克隆仓库

2. **创建分支**：从 `main` 创建功能分支
   ```bash
   git checkout -b feature/your-feature-name
   ```

3. **进行修改**：按照编码规范实现您的更改

4. **编写测试**：根据需要添加或更新测试

5. **运行测试**：确保所有测试通过
   ```bash
   make test
   ```

6. **提交更改**：遵循提交信息规范

7. **推送更改**：推送到您的 Fork
   ```bash
   git push origin feature/your-feature-name
   ```

8. **创建 PR**：创建 Pull Request，包含：
   - 清晰的标题和描述
   - 关联的 Issue 引用
   - 更改摘要
   - 已执行的测试

## 开发环境设置

### 前置要求

- Go 1.21 或更高版本
- Make

### 从源码构建

```bash
# 克隆仓库
git clone https://github.com/TencentCloudAgentRuntime/ags-cli.git
cd ags-cli

# 构建
make build

# 运行测试
make test

# 本地安装
make install
```

### 项目结构

```
ags-cli/
├── cmd/           # 命令实现
├── internal/      # 内部包
├── examples/      # 使用示例
├── build/         # 构建产物
└── main.go        # 入口点
```

## 编码规范

### Go 风格

- 遵循 [Effective Go](https://golang.org/doc/effective_go) 指南
- 使用 `gofmt` 格式化代码
- 提交前运行 `go vet`
- 保持函数简洁专注

### 错误处理

- 始终显式处理错误
- 提供有意义的错误信息
- 使用包装错误提供上下文

### 文档

- 为所有导出的函数和类型编写文档
- 保持注释与代码同步更新
- 在适当的地方包含示例

## 提交信息规范

遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

```
<type>(<scope>): <description>

[可选的正文]

[可选的脚注]
```

### 类型

- `feat`：新功能
- `fix`：Bug 修复
- `docs`：文档变更
- `style`：代码风格变更（格式化等）
- `refactor`：代码重构
- `test`：添加或更新测试
- `chore`：维护任务

### 示例

```
feat(run): 添加 Ruby 语言支持

fix(instance): 修复超时处理问题

docs(readme): 更新安装说明
```

## 审核流程

1. **自动检查**：所有 PR 必须通过 CI 检查
2. **代码审核**：需要至少一位维护者批准
3. **测试覆盖**：需要足够的测试覆盖率
4. **文档更新**：如需要则更新文档
5. **合并**：维护者将合并已批准的 PR

### 审核时间

- 初始响应：3 个工作日内
- 审核完成：取决于 PR 复杂度

## 有问题？

如果您有任何问题，欢迎：

- 创建讨论 Issue
- 联系维护者

感谢您为 AGS CLI 做出贡献！
